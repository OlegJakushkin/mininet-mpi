language: python
os: linux
dist: bionic
python: 3.8
      
services:
  - docker
  
install:
# Update packages
- sudo apt-get update

# Install tool for visualization
- pip install matplotlib

jobs:
  include:
    - name: "Mpi modeling on fattree topology"
      script:
        - . build.sh
        - echo "Run from $PWD"
        - ls
        - docker build -t containernet/containernet:ubuntu .
        - docker run --name containernet --rm --privileged --pid='host' -v /var/run/docker.sock:/var/run/docker.sock containernet/containernet ls
        - docker run --name containernet --rm --privileged --pid='host' -v /var/run/docker.sock:/var/run/docker.sock containernet/containernet ./mininet-mpi/run.sh fattree
      
    - name: "Mpi modeling on dragonfly topology"
      script:
        - . build.sh
        - echo "Run from $PWD"
        - ls
        - docker build -t containernet/containernet:ubuntu .
        - docker run --name containernet --rm --privileged --pid='host' -v /var/run/docker.sock:/var/run/docker.sock containernet/containernet ls
        - docker run --name containernet --rm --privileged --pid='host' -v /var/run/docker.sock:/var/run/docker.sock containernet/containernet ./mininet-mpi/run.sh dragonfly
